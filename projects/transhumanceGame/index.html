<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–ï–†–ï–ì–û–ù</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="game-container">
        
        <!-- UI –°–õ–û–ô -->
        <div id="ui-layer">
            <div>–ü–†–û–ß–ù–û–°–¢–¨ –î–í–ï–†–ò</div>
            <div class="bar-container"><div id="hp-bar"></div></div>
            <div>–í–´–ù–û–°–õ–ò–í–û–°–¢–¨ (–î–õ–Ø –£–î–ê–†–ê)</div>
            <div class="bar-container"><div id="stamina-bar"></div></div>
        </div>
        <div id="timer-display">–î–û –ü–û–ï–ó–î–ê: 60 —Å–µ–∫</div>

        <!-- –≠–§–§–ï–ö–¢–´ –ê–¢–ú–û–°–§–ï–†–´ -->
        <div id="snow-container"></div>
        <div id="frost-overlay"></div>

        <!-- –°–õ–û–ò –î–ï–ë–ê–ì–ê -->
        <div id="debug-layer" style="pointer-events: none; width: 100%; height: 100%; position: absolute; z-index: 50;"></div>

        <!-- –ù–û–ß–ù–û–ô –°–õ–û–ô -->
        <div id="night-layer">
            <div id="tower">
                <div class="window"></div>
                <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å –∫–ª–∏–∫–æ–º -->
                <div id="generator" onclick="toggleGenerator()">‚ö°</div>
            </div>
            <div id="light-barrier"></div>
            <div id="metal-rail"></div>
            <div id="train"><div class="headlight"></div></div>
        </div>

        <!-- –î–ù–ï–í–ù–û–ô –°–õ–û–ô -->
        <div id="day-screen" class="hidden morning">
            <div id="sky-sun"></div>
            <div id="day-ui-header">–î–ï–ù–¨ 1: –£–¢–†–û</div>
            
            <div id="day-tower-wrapper">
                <div id="room-attic" class="tower-section">
                    <div class="room-visual">
                        <div class="attic-window left"></div><div class="attic-window right"></div>
                        <div class="furniture chair-bed"></div><div class="furniture table-small"></div><div class="stairs"></div>
                    </div>
                    <span class="room-label">–ß–ï–†–î–ê–ö</span>
                    <div class="btn-overlay"><div style="font-size:10px;">[–û–±–∑–æ—Ä]</div></div>
                </div>
                <div id="room-living" class="tower-section">
                    <div class="room-visual split-room">
                        <div class="zone zone-bed-m"><div class="bed"><div class="wounded-guy"></div></div></div>
                        <div class="zone zone-kitchen"><div class="stove-pipe"></div><div class="stove"></div><div class="table-dinner"></div></div>
                        <div class="zone zone-bed-f"><div class="bed"></div><div class="flower-pot">üåª</div></div><div class="stairs"></div>
                    </div>
                    <span class="room-label">–ñ–ò–õ–ê–Ø –ö–û–ú–ù–ê–¢–ê</span>
                    <div class="btn-overlay">
                        <button id="btn-heal" class="activity-btn" onclick="startActivity('heal')">–ü–ï–†–ï–í–Ø–ó–ö–ê (+–ñ–∏–∑–Ω—å)</button>
                        <button id="btn-funeral" class="activity-btn hidden" onclick="startActivity('funeral')" style="border-color: #555; color: #aaa;">–ü–û–•–û–†–û–ù–´ (-1 –î–ï–ô–°–¢–í)</button>
                        <button class="activity-btn" onclick="startActivity('rest')">–†–Æ–ö–ó–ê–ö (+–°–∏–ª—ã)</button>
                    </div>
                </div>
                <div id="room-main" class="tower-section">
                    <div class="room-visual">
                        <div class="hanging-rail"></div><div class="diesel-gen">‚ö°</div><div class="workbench-table"></div><div class="stairs"></div>
                    </div>
                    <span class="room-label">–û–°–ù–û–í–ù–û–ï –ü–û–ú–ï–©–ï–ù–ò–ï</span>
                    <div class="btn-overlay">
                        <button id="btn-repair" class="activity-btn hidden" onclick="startActivity('repair')">–ü–û–ß–ò–ù–ö–ê (+HP)</button>
                        <button class="activity-btn" onclick="startActivity('upgrade')">–í–ï–†–°–¢–ê–ö (+–†–µ–ª—å—Å–∞)</button>
                    </div>
                </div>
                <div id="room-basement" class="tower-section">
                    <div class="room-visual basement-style">
                        <div class="shelf shelf-1"></div><div class="shelf shelf-2"></div><div class="box box-1"></div><div class="box box-2"></div>
                    </div>
                    <span class="room-label">–ü–û–î–í–ê–õ</span>
                    <div class="btn-overlay"><button class="activity-btn" onclick="startActivity('scavenge')">–ü–û–ò–°–ö (+–†–µ—Å—É—Ä—Å)</button></div>
                </div>
            </div>
        </div>

        <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ú–ò–ù–ò-–ò–ì–† -->
        <div id="mini-game-modal" class="hidden">
            <div class="mg-content">
                <h2 id="mg-title">–ê–ö–¢–ò–í–ù–û–°–¢–¨</h2>
                <p id="mg-desc">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</p>
                <div id="mg-area" class="mg-game-area"></div>
                <button id="mg-close-btn" class="game-btn hidden" onclick="closeMiniGame()">–ó–ê–í–ï–†–®–ò–¢–¨</button>
            </div>
        </div>
        
        <!-- –û–í–ï–†–õ–ï–ô –û–ë–£–ß–ï–ù–ò–Ø -->
        <div id="tutorial-overlay" class="hidden">
            <div id="tutorial-box" class="tutorial-box">
                <p id="tutorial-text">–¢–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏</p>
                <button class="game-btn" onclick="closeTutorial()">–ü–û–ù–Ø–õ</button>
            </div>
        </div>

        <!-- –î–ï–ë–ê–ì –ò–ù–¢–ï–†–§–ï–ô–° -->
        <button id="debug-toggle-btn" class="hidden" onclick="toggleDebugMenu()">‚öôÔ∏è DEV</button>
        <div id="debug-menu" class="hidden">
            <h3>DEBUG MENU</h3>
            <div class="debug-section">
                <button onclick="skipNight()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ù–æ—á—å (Win)</button>
                <button onclick="skipDay()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –î–µ–Ω—å</button>
                <button onclick="killAllEnemies()">–£–±–∏—Ç—å –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤</button>
            </div>
            <div class="debug-section">
                <label><input type="checkbox" onchange="toggleFlag('guyActive', this.checked)"> –ü–∞—Ä–µ–Ω—å –ó–¥–æ—Ä–æ–≤ (guyActive)</label><br>
                <label><input type="checkbox" onchange="toggleFlag('isGuyDead', this.checked)"> –ü–∞—Ä–µ–Ω—å –ú–µ—Ä—Ç–≤ (isGuyDead)</label><br>
                <label><input type="checkbox" onchange="toggleFlag('infStats', this.checked)"> –ë–µ—Å–∫. HP/Stamina</label><br>
                <label><input type="checkbox" onchange="toggleFlag('infAP', this.checked)"> –ë–µ—Å–∫. –û—á–∫–∏ –î–µ–π—Å—Ç–≤–∏–π</label>
            </div>
            <div class="debug-section">
                <label><input type="checkbox" onchange="toggleVisual('atk', this.checked)"> –ü–æ–∫–∞–∑–∞—Ç—å –†–∞–¥–∏—É—Å –ê—Ç–∞–∫–∏</label>
                <input type="range" min="100" max="600" value="300" oninput="setRadius('atk', this.value)"> <span id="val-atk">300</span><br>
                
                <label><input type="checkbox" onchange="toggleVisual('light', this.checked)"> –ü–æ–∫–∞–∑–∞—Ç—å –†–∞–¥–∏—É—Å –°–≤–µ—Ç–∞</label>
                <input type="range" min="50" max="400" value="150" oninput="setRadius('light', this.value)"> <span id="val-light">150</span>
            </div>
            <div class="debug-section">
                –î–µ–Ω—å: <input type="number" id="debug-day-input" value="1" style="width: 40px;"> 
                <button onclick="setDay()">Set</button>
            </div>
            <button onclick="toggleDebugMenu()" style="background:#555;">–ó–ê–ö–†–´–¢–¨</button>
        </div>

    </div>

    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div id="main-menu">
        <h1 class="game-title">–ü–ï–†–ï–ì–û–ù</h1>
        <div class="menu-buttons">
            <button onclick="startFromMenu()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            <button id="btn-demo-mode" class="hidden" onclick="startDemoMode()" style="border-color: #ffeb3b; color: #ffeb3b;">–î–ï–ú–û: –ú–ò–ù–ò-–ò–ì–†–´</button>
            <button id="btn-test-menu" class="hidden" onclick="openMiniGameTestMenu()" style="border-color: #00bcd4; color: #00bcd4;">–¢–ï–°–¢ –ú–ò–ù–ò-–ò–ì–†</button>
            <button onclick="alert('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">–ó–ê–ì–†–£–ó–ò–¢–¨</button>
            <button onclick="alert('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">–ù–ê–°–¢–†–û–ô–ö–ò</button>
            <button onclick="alert('–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: AI & User')">–ö–†–ï–î–ò–¢–´</button>
            <button onclick="alert('–î–ª—è –≤—ã—Ö–æ–¥–∞ –∑–∞–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É')">–í–´–•–û–î</button>
        </div>
    </div>
    
    <!-- –ú–ï–ù–Æ –¢–ï–°–¢–ê –ú–ò–ù–ò-–ò–ì–† -->
    <div id="minigame-test-menu" class="hidden" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #222; z-index: 210; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <h2>–¢–ï–°–¢ –ú–ò–ù–ò-–ò–ì–†</h2>
        <div style="display:flex; flex-wrap:wrap; gap:10px; max-width:600px; justify-content:center;">
            <button class="game-btn" onclick="startActivity('scavenge', true)">–ü–û–ò–°–ö</button>
            <button class="game-btn" onclick="startActivity('upgrade', true)">–°–û–†–¢–ò–†–û–í–ö–ê (–£–ª—É—á—à–µ–Ω–∏–µ)</button>
            <button class="game-btn" onclick="startActivity('repair', true)">–†–ï–ú–û–ù–¢</button>
            <button class="game-btn" onclick="startActivity('heal', true)">–°–ò–ù–¢–ï–ó (–õ–µ—á–µ–Ω–∏–µ)</button>
            <button class="game-btn" onclick="startActivity('rest', true)">–†–Æ–ö–ó–ê–ö (–û—Ç–¥—ã—Ö)</button>
            <button class="game-btn" onclick="startActivity('funeral', true)">–ü–û–•–û–†–û–ù–´</button>
        </div>
        <button class="game-btn" onclick="closeMiniGameTestMenu()" style="margin-top:20px; background:#555;">–ù–ê–ó–ê–î –í –ú–ï–ù–Æ</button>
    </div>

    <!-- –≠–ö–†–ê–ù–´ –°–û–°–¢–û–Ø–ù–ò–ô -->
    <div id="intro-screen" class="hidden">
        <!-- –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï –î–õ–Ø –ù–û–í–ï–õ–õ–´ -->
        <img id="intro-img" class="vn-image hidden" src="" alt="">
        <p id="intro-text">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        <button class="game-btn" onclick="nextIntro()">–î–ê–õ–ï–ï</button>
    </div>

    <!-- –≠–ö–†–ê–ù –ù–ê–ß–ê–õ–ê –ù–û–ß–ò -->
    <div id="night-start-screen" class="hidden">
        <h1 id="ns-title" style="color: #d32f2f">–°–£–ú–ï–†–ö–ò</h1>
        <p>–°–æ–ª–Ω—Ü–µ –∑–∞—à–ª–æ. –¢–µ–Ω–∏ –ø—Ä–∏–±–ª–∏–∂–∞—é—Ç—Å—è –∫ –±–∞—à–Ω–µ.<br>–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –æ–±–æ—Ä–æ–Ω–µ.</p>
        <button class="game-btn" onclick="confirmStartNight()">–ö –ë–û–Æ</button>
    </div>

    <div id="game-over-screen" class="hidden">
        <h1 id="go-title" style="color: #d32f2f">–û–ù–ò –ü–†–û–†–í–ê–õ–ò–°–¨</h1>
        <p id="go-desc">–î–≤–µ—Ä—å —Å–ª–æ–º–∞–Ω–∞. –°–≤–µ—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ—Ç.</p>
        <button class="game-btn" onclick="location.reload()">–ü–û–ü–†–û–ë–û–í–ê–¢–¨ –°–ù–û–í–ê</button>
    </div>

    <div id="win-screen" class="hidden">
        <h1 id="win-title" style="color: #4caf50">–ü–û–ï–ó–î –ü–†–ò–ë–´–õ</h1>
        <p id="win-desc">–ó–≤—É–∫ –≥—É–¥–∫–∞ —Ä–∞–∑–æ—Ä–≤–∞–ª —Ç—å–º—É.<br>–¢–≤–∞—Ä–∏ –∏—Å—á–µ–∑–ª–∏. –í—ã –¥–æ–∂–∏–ª–∏ –¥–æ —É—Ç—Ä–∞.</p>
        <button id="btn-next-day" class="game-btn" onclick="startDayPhase()">–ù–ê–ß–ê–¢–¨ –î–ï–ù–¨</button>
    </div>

    <script src="js/state.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/minigames.js"></script>
    <script src="js/day-cycle.js"></script>
    <script src="js/night-cycle.js"></script>
    <script src="js/main.js"></script>

</body>
</html>